## Лабораторная работа №8

Использование ETL инструментов на примере NiFi

### Краткий экскурс

[**NiFi**](https://habr.com/ru/company/rostelecom/blog/432166/) — это open source ETL/ELT-инструмент, который умеет работать со множеством систем.

[**ETL/ELT**](https://habr.com/ru/post/695546/) - два способа интеграции данных в одно хранилище.

> Основное различие между ними заключается в том, ГДЕ и КОГДА выполняются преобразование и загрузка данных. 
> При ETL данные преобразуются на временном этапе подготовки до того, как попадут в целевой репозиторий, 
> в то время как ELT позволяет преобразовывать данные после их загрузки в целевую систему. 

Расшифровка: *EXTRACT LOAD TRANSFORM* 

### Как выполнять и запускать данныю лр

1. Стырьте у меня main.py, где происходит создание json-файлика (немного переделав под себя естесственно)
2. Поставьте [nifi](https://nifi.apache.org/docs.html)
    ```bash
   # Установка
   brew install nifi
  
   # Запуск
   nifi start
   
   # Проверка работы
   nifi status
   
   # Завершение
   nifi stop
   ```
3. Создайте пользователя и зайдите в веб интерфейс
    ```bash
    nifi start
    nifi set-single-user-credentials <username> <password>
    nifi stop 
    ```
   
    ```bash
    nifi start
    # Открываем
    https://localhost:8443/nifi
    ```
4. Создаем новую группу
   ![img.png](img/img.png)

5. Правая кнопка мыши -> enter group -> зашли в группу
6. Перетаскиваем на поле необходимые процессоры

   (выбираем Processor, в поиске вбиваем название как в лабе)
   ![img_1.png](img/img_1.png)

7. Делаем первую тестовую связку
   ![img_2.png](img/img_2.png)
   ![img_3.png](img/img_3.png)
8. Запускаем тестовую связку
   ![img_4.png](img/img_4.png)
   Потом также стоп

   Если подождете достаточно времени, то очередь будет выглядеть так 
   ![img_6.png](img/img_6.png)
9. Настраиваем блок `ConvertRecord`
   ![img_7.png](img/img_7.png)
   ![img_8.png](img/img_8.png)
   ![img_9.png](img/img_9.png)
10. Также в этом блоке нужно настроить ридера и врайтера 
       * жмакаем на кнопку -> 
       * в открывшемся окне нажимаем на молнии справа, чтобы получилась такая картина
   ![img_10.png](img/img_10.png)

   Промежуточный результат
   ![img_11.png](img/img_11.png)
11. Настраиваем блок `split`
   ![img_12.png](img/img_12.png)
   ![img_13.png](img/img_13.png)
   ![img_14.png](img/img_14.png)

   Промежуточный результат
   ![img_15.png](img/img_15.png)
12. Пытаемся настроить соединение 
   ![img_1.png](img/img_111.png)
   ![img_2.png](img/img_21.png)
   ![img_3.png](img/img_31.png)
   ![img_4.png](img/img_41.png)
   ![img_5.png](img/img_51.png)
    (в папке nifi_tools лежит архив постгреса)
13. Put
   ![img_6.png](img/img_61.png)
14. Важно! Когда вы настраиваете любую связь не забывайте прописывать, что хотите передавать
   ![img_7.png](img/img_71.png)